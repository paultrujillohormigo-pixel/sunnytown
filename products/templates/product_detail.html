<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>{{ product.name }}</title>
<style>
.container {
    max-width: 900px;
    margin: 40px auto;
    background: #fff;
    padding: 30px;
    border-radius: 12px;
}
img {
    max-width: 300px;
    border-radius: 10px;
}
button {
    background: #28a745;
    color: #fff;
    padding: 12px 18px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 18px;
    margin-top: 20px;
}
</style>
</head>

<body>
<div class="container">
    <h1>{{ product.name }}</h1>

    <img src="{{ product.main_image }}" alt="{{ product.name }}">

    <p><strong>Precio:</strong> ${{ product.price }} MXN</p>
    <p>{{ product.description }}</p>

    <button onclick="pagar()">Comprar con Mercado Pago</button>
    <p id="estado"></p>
</div>

<script>
function pagar() {
    const estado = document.getElementById("estado");
    estado.innerText = "Generando link de pago...";

    fetch("/products/crear_pago", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            product_id: {{ product.id }},
            amount: {{ product.price }},
            title: "{{ product.name }}"
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.link) {
            estado.innerText = "";
            window.location.href = data.link; // Redirect al checkout
        } else {
            estado.innerText = "Error generando link de pago";
        }
    })
    .catch(err => {
        estado.innerText = "Error generando pago";
    });
}
</script>
</body>
</html>
